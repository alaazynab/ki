
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>حساب جرعة يوديد البوتاسيوم</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            direction: rtl;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            margin: auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 6px;
        }
        input {
            width: 100%;
            padding: 8px;
            font-size: 16px;
        }
        button {
            background-color: #1976d2;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
        }
        button:hover {
            background-color: #0d47a1;
        }
        .result {
            margin-top: 20px;
            padding: 10px;
            background-color: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 5px;
        }
    </style>
<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAnFBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8qVXzJAAAAKHRSTlMAAQIDBAYKDA8RGyAlKjM+RUpXW2NkgY+Zp7G2xsnZ4+jx9fr7/CYQ6QAAAGVJREFUGNNjYAACJiYGJhYWRmZGBiYWVjYGBgYmRkZmBiYmRgYmFgZGBkYmBgZGJgYmZgYGBiYmAAImJgYCRjYGBgZGRgYGBoZGZgYGJgYGRg4BEAJ1QNU1WydVwAAAABJRU5ErkJggg==" type="image/png">
</head>
<body>
    <div class="container">
        <h2>🧪 حساب جرعة يوديد البوتاسيوم</h2>
        <div class="form-group">
            <label for="civilId">الرقم المدني:</label>
            <input type="text" id="civilId" placeholder="مثال: 299010112345">
        </div>
        <div class="form-group">
            <label for="weight">الوزن بالكغ:</label>
            <input type="number" id="weight" placeholder="مثال: 70" min="1">
        </div>
        <div class="form-group">
            <label for="height">الطول بالسنتيمتر:</label>
            <input type="number" id="height" placeholder="مثال: 170" min="30">
        </div>
        <button onclick="calculateDose()">احسب الجرعة</button>
    <button onclick="downloadPDF()" style="margin-top:10px;background-color:#388e3c;">📄 حفظ النتيجة كـ PDF</button>
        <div class="result" id="result" style="display:none;"></div>
    </div>

    <script>
        function calculateDose() {
            const civilId = document.getElementById('civilId').value.trim();
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const resultDiv = document.getElementById('result');

            if (civilId.length < 12 || isNaN(weight) || isNaN(height)) {
                resultDiv.innerHTML = "⚠️ الرجاء إدخال الرقم المدني الصحيح والوزن والطول.";
                resultDiv.style.display = "block";
                return;
            }

            const centuryCode = parseInt(civilId.charAt(0));
            let century;
            if (centuryCode === 1) century = 1800;
            else if (centuryCode === 2) century = 1900;
            else if (centuryCode === 3) century = 2000;
            else {
                resultDiv.innerHTML = "⚠️ رمز القرن في الرقم المدني غير معروف.";
                resultDiv.style.display = "block";
                return;
            }

            const year = century + parseInt(civilId.substr(1, 2));
            const month = parseInt(civilId.substr(3, 2));
            const day = parseInt(civilId.substr(5, 2));

            const birthDate = new Date(year, month - 1, day);
            const today = new Date();

            if (isNaN(birthDate)) {
                resultDiv.innerHTML = "⚠️ تاريخ الميلاد غير صالح.";
                resultDiv.style.display = "block";
                return;
            }

            let ageYears = today.getFullYear() - birthDate.getFullYear();
            if (
                today.getMonth() < birthDate.getMonth() ||
                (today.getMonth() === birthDate.getMonth() && today.getDate() < birthDate.getDate())
            ) {
                ageYears--;
            }

            let ageMonths = (today.getFullYear() - birthDate.getFullYear()) * 12 + (today.getMonth() - birthDate.getMonth());
            if (today.getDate() < birthDate.getDate()) {
                ageMonths--;
            }

            let dose = "";
            let form = "";
            let warning = "";

            if (ageMonths < 1) {
                dose = "غير موصى به";
                form = "🚫 لا يُعطى قبل عمر شهر إلا بإشراف طبي";
            } else if (ageMonths < 3) {
                dose = "16 ملغ";
                form = "شراب";
            } else if (ageMonths < 36) {
                dose = "32 ملغ";
                form = "شراب";
            } else if (ageYears >= 12 && weight >= 70) {
                dose = "130 ملغ";
                form = "حبوب";
            } else {
                dose = "65 ملغ";
                form = "حبوب";
            }

            // حساب BMI
            let heightMeters = height / 100;
            let bmi = (weight / (heightMeters * heightMeters)).toFixed(1);

            // حساب الوزن المثالي (متوسط بين Broca وتقدير آخر)
            let idealWeight = (height - 100 + (height - 150) / 4).toFixed(1);

            // حساب BSA (Mosteller formula)
            let bsa = Math.sqrt((height * weight) / 3600).toFixed(2);

            const birthDateFormatted = birthDate.toLocaleDateString('ar-EG', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });

            resultDiv.innerHTML = `
                <strong>📅 تاريخ الميلاد:</strong> ${birthDateFormatted}<br>
                <strong>👶 العمر:</strong> ${ageYears} سنة (${ageMonths} شهر)<br>
                <strong>⚖️ الوزن:</strong> ${weight} كغ<br>
                <strong>💊 الجرعة:</strong> ${dose}<br>
                <strong>📌 الشكل الدوائي:</strong> ${form}<br>
                <strong>📏 مؤشر كتلة الجسم (BMI):</strong> ${bmi}<br>
                <strong>🧍 الوزن المثالي:</strong> ${idealWeight} كغ<br>
                <strong>📐 مساحة سطح الجسم (BSA):</strong> ${bsa} م²<br>
                ${warning}
            `;
            resultDiv.style.display = "block";
        }
    </script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
    function downloadPDF() {
        const resultText = document.getElementById('result').innerText;
        if (!resultText) {
            alert("يرجى أولاً حساب الجرعة قبل تصدير النتيجة.");
            return;
        }

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFont("helvetica");
        doc.setFontSize(12);
        doc.text(resultText, 10, 20, { maxWidth: 180, align: "right" });
        doc.save("KI_dose_result.pdf");
    }
</script>
</body>
</html>
