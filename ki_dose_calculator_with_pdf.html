
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø­Ø³Ø§Ø¨ Ø¬Ø±Ø¹Ø© ÙŠÙˆØ¯ÙŠØ¯ Ø§Ù„Ø¨ÙˆØªØ§Ø³ÙŠÙˆÙ…</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            direction: rtl;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            margin: auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 6px;
        }
        input {
            width: 100%;
            padding: 8px;
            font-size: 16px;
        }
        button {
            background-color: #1976d2;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
        }
        button:hover {
            background-color: #0d47a1;
        }
        .result {
            margin-top: 20px;
            padding: 10px;
            background-color: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 5px;
        }
    </style>
<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAnFBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8qVXzJAAAAKHRSTlMAAQIDBAYKDA8RGyAlKjM+RUpXW2NkgY+Zp7G2xsnZ4+jx9fr7/CYQ6QAAAGVJREFUGNNjYAACJiYGJhYWRmZGBiYWVjYGBgYmRkZmBiYmRgYmFgZGBkYmBgZGJgYmZgYGBiYmAAImJgYCRjYGBgZGRgYGBoZGZgYGJgYGRg4BEAJ1QNU1WydVwAAAABJRU5ErkJggg==" type="image/png">
</head>
<body>
    <div class="container">
        <h2>ğŸ§ª Ø­Ø³Ø§Ø¨ Ø¬Ø±Ø¹Ø© ÙŠÙˆØ¯ÙŠØ¯ Ø§Ù„Ø¨ÙˆØªØ§Ø³ÙŠÙˆÙ…</h2>
        <div class="form-group">
            <label for="civilId">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ:</label>
            <input type="text" id="civilId" placeholder="Ù…Ø«Ø§Ù„: 299010112345">
        </div>
        <div class="form-group">
            <label for="weight">Ø§Ù„ÙˆØ²Ù† Ø¨Ø§Ù„ÙƒØº:</label>
            <input type="number" id="weight" placeholder="Ù…Ø«Ø§Ù„: 70" min="1">
        </div>
        <div class="form-group">
            <label for="height">Ø§Ù„Ø·ÙˆÙ„ Ø¨Ø§Ù„Ø³Ù†ØªÙŠÙ…ØªØ±:</label>
            <input type="number" id="height" placeholder="Ù…Ø«Ø§Ù„: 170" min="30">
        </div>
        <button onclick="calculateDose()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø©</button>
    <button onclick="downloadPDF()" style="margin-top:10px;background-color:#388e3c;">ğŸ“„ Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒÙ€ PDF</button>
        <div class="result" id="result" style="display:none;"></div>
    </div>

    <script>
        function calculateDose() {
            const civilId = document.getElementById('civilId').value.trim();
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const resultDiv = document.getElementById('result');

            if (civilId.length < 12 || isNaN(weight) || isNaN(height)) {
                resultDiv.innerHTML = "âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ Ø§Ù„ØµØ­ÙŠØ­ ÙˆØ§Ù„ÙˆØ²Ù† ÙˆØ§Ù„Ø·ÙˆÙ„.";
                resultDiv.style.display = "block";
                return;
            }

            const centuryCode = parseInt(civilId.charAt(0));
            let century;
            if (centuryCode === 1) century = 1800;
            else if (centuryCode === 2) century = 1900;
            else if (centuryCode === 3) century = 2000;
            else {
                resultDiv.innerHTML = "âš ï¸ Ø±Ù…Ø² Ø§Ù„Ù‚Ø±Ù† ÙÙŠ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ.";
                resultDiv.style.display = "block";
                return;
            }

            const year = century + parseInt(civilId.substr(1, 2));
            const month = parseInt(civilId.substr(3, 2));
            const day = parseInt(civilId.substr(5, 2));

            const birthDate = new Date(year, month - 1, day);
            const today = new Date();

            if (isNaN(birthDate)) {
                resultDiv.innerHTML = "âš ï¸ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ ØºÙŠØ± ØµØ§Ù„Ø­.";
                resultDiv.style.display = "block";
                return;
            }

            let ageYears = today.getFullYear() - birthDate.getFullYear();
            if (
                today.getMonth() < birthDate.getMonth() ||
                (today.getMonth() === birthDate.getMonth() && today.getDate() < birthDate.getDate())
            ) {
                ageYears--;
            }

            let ageMonths = (today.getFullYear() - birthDate.getFullYear()) * 12 + (today.getMonth() - birthDate.getMonth());
            if (today.getDate() < birthDate.getDate()) {
                ageMonths--;
            }

            let dose = "";
            let form = "";
            let warning = "";

            if (ageMonths < 1) {
                dose = "ØºÙŠØ± Ù…ÙˆØµÙ‰ Ø¨Ù‡";
                form = "ğŸš« Ù„Ø§ ÙŠÙØ¹Ø·Ù‰ Ù‚Ø¨Ù„ Ø¹Ù…Ø± Ø´Ù‡Ø± Ø¥Ù„Ø§ Ø¨Ø¥Ø´Ø±Ø§Ù Ø·Ø¨ÙŠ";
            } else if (ageMonths < 3) {
                dose = "16 Ù…Ù„Øº";
                form = "Ø´Ø±Ø§Ø¨";
            } else if (ageMonths < 36) {
                dose = "32 Ù…Ù„Øº";
                form = "Ø´Ø±Ø§Ø¨";
            } else if (ageYears >= 12 && weight >= 70) {
                dose = "130 Ù…Ù„Øº";
                form = "Ø­Ø¨ÙˆØ¨";
            } else {
                dose = "65 Ù…Ù„Øº";
                form = "Ø­Ø¨ÙˆØ¨";
            }

            // Ø­Ø³Ø§Ø¨ BMI
            let heightMeters = height / 100;
            let bmi = (weight / (heightMeters * heightMeters)).toFixed(1);

            // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ (Ù…ØªÙˆØ³Ø· Ø¨ÙŠÙ† Broca ÙˆØªÙ‚Ø¯ÙŠØ± Ø¢Ø®Ø±)
            let idealWeight = (height - 100 + (height - 150) / 4).toFixed(1);

            // Ø­Ø³Ø§Ø¨ BSA (Mosteller formula)
            let bsa = Math.sqrt((height * weight) / 3600).toFixed(2);

            const birthDateFormatted = birthDate.toLocaleDateString('ar-EG', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });

            resultDiv.innerHTML = `
                <strong>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</strong> ${birthDateFormatted}<br>
                <strong>ğŸ‘¶ Ø§Ù„Ø¹Ù…Ø±:</strong> ${ageYears} Ø³Ù†Ø© (${ageMonths} Ø´Ù‡Ø±)<br>
                <strong>âš–ï¸ Ø§Ù„ÙˆØ²Ù†:</strong> ${weight} ÙƒØº<br>
                <strong>ğŸ’Š Ø§Ù„Ø¬Ø±Ø¹Ø©:</strong> ${dose}<br>
                <strong>ğŸ“Œ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø¯ÙˆØ§Ø¦ÙŠ:</strong> ${form}<br>
                <strong>ğŸ“ Ù…Ø¤Ø´Ø± ÙƒØªÙ„Ø© Ø§Ù„Ø¬Ø³Ù… (BMI):</strong> ${bmi}<br>
                <strong>ğŸ§ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ:</strong> ${idealWeight} ÙƒØº<br>
                <strong>ğŸ“ Ù…Ø³Ø§Ø­Ø© Ø³Ø·Ø­ Ø§Ù„Ø¬Ø³Ù… (BSA):</strong> ${bsa} Ù…Â²<br>
                ${warning}
            `;
            resultDiv.style.display = "block";
        }
    </script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
    function downloadPDF() {
        const resultText = document.getElementById('result').innerText;
        if (!resultText) {
            alert("ÙŠØ±Ø¬Ù‰ Ø£ÙˆÙ„Ø§Ù‹ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø© Ù‚Ø¨Ù„ ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªÙŠØ¬Ø©.");
            return;
        }

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFont("helvetica");
        doc.setFontSize(12);
        doc.text(resultText, 10, 20, { maxWidth: 180, align: "right" });
        doc.save("KI_dose_result.pdf");
    }
</script>
</body>
</html>
